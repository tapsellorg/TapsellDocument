---
layout: classic-docs
title: راه اندازی تپسل پلاس در یونیتی (Android)
lang: fa
permalink: /plus-sdk/unity/initialize-android/index.html
toc: true # table of contents
---


## اضافه کردن Unity Package تپسل پلاس
برای اضافه کردن کتابخانه‌های مورد نیاز ۲ روش وجود دارد از هرکدام که مایل هستید استفاده کنید.

### ۱. استفاده از Gradle
۱. ابتدا `unitypackage` تپسل پلاس را از [این لینک](https://github.com/tapsellorg/TapsellPlusSDK-UnitySample2019/releases/download/v2.1.6/TapsellPlusUnity-Gradle-v2.1.6.unitypackage) دریافت نمایید. 
۲. از طریق منوی زیر `unitypackage` تپسل پلاس را به پروژه‌ی خود اضافه نمایید. (اگر فولدر TapsellPlus از قبل در پروژه‌ی شما وجود دارد لطفا آن را پاک کنید)

```console
Assets > Import Package > Custom Package...
```

۳. از طریق منوهای زیر، تیک‌های مربوط به ایجاد فایل‌های Custom Gradle را بزنید:

```console
Edit > Project Setting... > Player > Publishing Settings > Custom Launcher Gradle Template
Edit > Project Setting... > Player > Publishing Settings > Custom Main Gradle Template
Edit > Project Setting... > Player > Publishing Settings > Custom Base Gradle Template
```

۴. به آدرس ‍‍`Assets\Plugins\Android\mainTemplate.gradle` بروید و :خط کامنت شده‌ی بالای فایل را حذف نمایید
```gradle
// GENERATED BY UNITY. REMOVE THIS COMMENT TO PREVENT OVERWRITING WHEN EXPORTING AGAIN
```
سپس در بخش `dependencies` خط زیر را اضافه نمایید:
```gradle
dependencies {
    ...
    implementation 'ir.tapsell.plus:tapsell-plus-sdk-unity:2.1.6'
    ...
**DEPS**}
```
اگر تکه کد زیر نیز در فایل وجود نداشت آن را اضافه نمایید:
```gradle
android {
  compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
  }
}
```

۵. به آدرس `Assets\Plugins\Android\baseProjectTemplate.gradle` بروید و عبارت `mavenCentral()` را به هر دو بخش `repositories` اضافه نمایید. سپس ورژن `com.android.tools.build:gradle` را به ۳.۶.۰ تغییر دهید.


> دقت داشته باشید که استفاده از ورژن ۳.۶.۰ برای Android Gradle Plugin الزامی است. زیرا برای پشتیبانی از اندروید یازده می‌بایستی حداقل از این ورژن در پروژه پشتیبانی شود. برای اضافه کردن نسخه‌ای از Gradle که قابلیت پشتیبانی از اندروید یازده را دارد، می‌توانید از [این لینک](https://developers.google.com/ar/develop/unity/android-11-build) کمک بگیرید.

۶. بعد از اضافه کردن تپسل پلاس و شبکه‌های تبلیغاتی دیگر احتمالا به دلیل بالا رفتن حجم کد و جلوگیری از وقوع خطای زیر می‌بایستی MultiDex را فعال نمایید.  
```console
D8: Cannot fit requested classes in a single dex file (# methods: 68109 > 65536)
```
نحوه‌ی فعال‌سازی MultiDex به این ترتیب است که به آدرس `Assets\Plugins\Android\launcherTemplate.gradle` بروید و تکه کد زیر را به آن اضافه نمایید:
```gradle
android {
  ...
  defaultConfig {
    ...
    multiDexEnabled true
  }
  ...
}
```

### ۲. استفاده از Resolver

۱. ابتدا فایل [unitypackage resolver](https://github.com/googlesamples/unity-jar-resolver/releases) را دانلود کنید. سپس مطابق توضیحات لینک زیر آن را به پروژه‌ی خود اضافه نمایید:  

[مستندات گوگل](https://github.com/googlesamples/unity-jar-resolver#android-resolver-usage) 

۲. از طریق منوهای زیر، تیک مربوط به `Jetifier` و `Auto Resolution` را بزنید. (تیک مربوط به `Auto Resolution` اجباری نیست اما برای آن که هر بار مجبور نباشید کتابخانه‌ها را به شکل دستی Resolve کنید بهتر است آن را فعال کنید)

```console
Assets > External Dependency Manager > Android Resolver > Settings > Use Jetifier
Assets > External Dependency Manager > Android Resolver > Settings > Enable Auto-Resolution
```

۳. ابتدا `unitypackage` تپسل پلاس را از [این لینک](https://github.com/tapsellorg/TapsellPlusSDK-UnitySample2019/releases/download/v2.1.3/TapsellPlusUnity-EDM-v2.1.3.unitypackage) دریافت نمایید. 

۴. از طریق منوی زیر `unitypackage` تپسل پلاس را به پروژه‌ی خود اضافه نمایید. (اگر فولدر TapsellPlus از قبل در پروژه‌ی شما وجود دارد لطفا آن را پاک کنید)

```console
Assets > Import Package > Custom Package...
```

۵. برای اطمینان از اضافه شدن پلاگین تپسل پلاس از طریق منوی زیر اقدام به Resolve کردن کتابخانه‌ها کنید:

```console
Assets > External Dependency Manager > Android Resolver > Force Resolve
```

۶. از طریق منوهای زیر، تیک‌های مربوط به ایجاد فایل‌های Custom Gradle را بزنید:

```console
Edit > Project Setting... > Player > Publishing Settings > Custom Launcher Gradle Template
Edit > Project Setting... > Player > Publishing Settings > Custom Base Gradle Template
```

۴. 
اگر تکه کد زیر در آدرس `Assets\Plugins\Android\launcherTemplate.gradle` وجود نداشت آن را اضافه نمایید:
```gradle
android {
  compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
  }
}
```

۵. به آدرس `Assets\Plugins\Android\baseProjectTemplate.gradle` بروید و عبارت `mavenCentral()` را به هر دو بخش `repositories` اضافه نمایید. سپس ورژن `com.android.tools.build:gradle` را به ۳.۶.۰ تغییر دهید.


> دقت داشته باشید که استفاده از ورژن ۳.۶.۰ برای Android Gradle Plugin الزامی است. زیرا برای پشتیبانی از اندروید یازده می‌بایستی حداقل از این ورژن در پروژه پشتیبانی شود. برای اضافه کردن نسخه‌ای از Gradle که قابلیت پشتیبانی از اندروید یازده را دارد، می‌توانید از [این لینک](https://developers.google.com/ar/develop/unity/android-11-build) کمک بگیرید.

۶. بعد از اضافه کردن تپسل پلاس و شبکه‌های تبلیغاتی دیگر احتمالا به دلیل بالا رفتن حجم کد و جلوگیری از وقوع خطای زیر می‌بایستی MultiDex را فعال نمایید.
```console
D8: Cannot fit requested classes in a single dex file (# methods: 68109 > 65536)
```
نحوه‌ی فعال‌سازی MultiDex به این ترتیب است که به آدرس `Assets\Plugins\Android\launcherTemplate.gradle` بروید و تکه کد زیر را به آن اضافه نمایید:
```gradle
android {
  ...
  defaultConfig {
    ...
    multiDexEnabled true
  }
  ...
}
```

## مقداردهی اولیه
ابتدا برای دسترسی به کدهای تپسل از تکه کد زیر استفاده کنید.

```c#
using TapsellPlusSDK;
```

سپس تابع زیر را در یکی از اسکریپت‌های برنامه‌ی خود که در ابتدای برنامه اجرا می‌شود فراخوانی کنید.

```c#
TapsellPlus.Initialize(TAPSELLPLUS_KEY,
            adNetworkName => Debug.Log(adNetworkName + " Initialized Successfully."),
            error => Debug.Log(error.ToString()));
```

`TAPSELLPLUS_KEY` کلید تپسل پلاس هست و برای هر اپلیکیشنی که می‌سازید در [پنل تپسل](https://dashboard.tapsell.ir/) ساخته می‌شود و می‌توانید از پنل کپی کنید.

اکنون می‌توانید با توجه به نیاز خود و توضیحات به هر نوع تبلیغ، تبلیغ مورد نظر را نمایش دهید.

## تنظیمات مربوط به GDPR
از آن‌جا که کتابخانه‌ی تپسل پلاس قوانین GDPR را در خصوص نمایش تبلیغات شخصی‌سازی شده رعایت می‌کند، به طور پیش فرض اگر کاربر با IP یکی از کشورهای مشمول این قانون از اپلیکیشن شما استفاده کند، دیالوگی در این خصوص به کاربر نمایش می‌دهد. اگر تمایل دارید تا به جای تصمیم کاربر، خودتان دسترسی لازم را تعیین کنید می‌توانید از تکه کد زیر استفاده نمایید. توجه داشته باشید که این تکه کد می‌بایستی پس از Initialize شدن تپسل پلاس و پیش از درخواست تبلیغ صدا زده شود تا نتیجه‌ی آن در درخواست شما اعمال شده باشد. مقدار true‌ به این معنی است که شما حق استفاده از اطلاعات جهت نمایش تبلیغ شخصی‌سازی شده را به شبکه‌های تبلیغاتی داده‌اید.
```c#
TapsellPlus.SetGdprConsent(true);
```

## پروژه‌ی نمونه
برای راهنمایی بیش‌تر می‌توانید از پروژه‌های نمونه‌ی ما بر روی Github استفاده نمایید.

* [پروژه‌ی نمونه مناسب برای Unity 2020.3.9f1 LTS](https://github.com/tapsellorg/TapsellPlusSDK-UnitySample2020)

* [پروژه‌ی نمونه مناسب برای Unity 2019.4.11f1 LTS](https://github.com/tapsellorg/TapsellPlusSDK-UnitySample2019)

* [پروژه‌ی نمونه مناسب برای Unity 2018.4.26f1 LTS](https://github.com/tapsellorg/TapsellPlusSDK-UnitySample2018)